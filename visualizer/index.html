<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lean Observatory â€” Treemap</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500&display=swap" rel="stylesheet" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="badge">Lean Observatory</div>
        <div class="title">Metrics Explorer</div>
        <nav class="view-tabs">
          <button class="view-tab active" data-view="treemap">Treemap</button>
          <button class="view-tab" data-view="timeline">Timeline</button>
          <button class="view-tab" data-view="allocs">Allocs</button>
        </nav>
      </div>
      <div class="controls">
        <label class="control">
          <span>Metrics JSON</span>
          <input id="fileInput" type="file" accept="application/json" />
        </label>
        <label class="control">
          <span>Root Path (for editor links)</span>
          <input id="rootInput" type="text" placeholder="/abs/path/to/project" />
        </label>
        <div class="control">
          <span>Metric Category</span>
          <div class="category-toggle" id="categoryToggle">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="compile">Compile</button>
            <button class="category-btn" data-category="runtime">Runtime</button>
          </div>
        </div>
        <label class="control">
          <span>Size Metric</span>
          <select id="sizeSelect"></select>
        </label>
        <label class="control">
          <span>Color Metric</span>
          <select id="colorSelect"></select>
        </label>
        <label class="control toggle">
          <input id="showLabels" type="checkbox" />
          <span>Show labels</span>
        </label>
      </div>
      <div class="blend-panel" id="blendPanel" hidden>
        <div class="blend-title">Blend Weights</div>
        <div class="blend-list" id="blendList"></div>
      </div>
    </header>

    <main class="panel">
      <!-- Treemap View -->
      <section class="canvas view-container" id="treemapView">
        <div id="treemap"></div>
        <div id="tooltip" class="tooltip" hidden></div>
      </section>

      <!-- Timeline View (GPU kernel Gantt chart) -->
      <section class="canvas view-container" id="timelineView" hidden>
        <div class="timeline-header">
          <h3>GPU Kernel Timeline</h3>
          <div class="timeline-controls">
            <label class="control">
              <span>Color By</span>
              <select id="timelineColorBy">
                <option value="kernel">Kernel Name</option>
                <option value="stream">Stream</option>
                <option value="duration">Duration</option>
              </select>
            </label>
          </div>
        </div>
        <div id="timeline"></div>
      </section>

      <!-- Allocs View (Memory waterfall) -->
      <section class="canvas view-container" id="allocsView" hidden>
        <div class="allocs-header">
          <h3 id="allocsTitle">Memory Allocations</h3>
          <div class="allocs-controls">
            <label class="control">
              <span>Group By</span>
              <select id="allocsGroupBy">
                <option value="time">Time</option>
                <option value="file">File</option>
                <option value="decl">Declaration</option>
              </select>
            </label>
            <div class="allocs-legend" id="allocsLegend">
              <div class="legend-item" data-event="alloc">
                <span class="legend-swatch alloc"></span>
                Alloc
              </div>
              <div class="legend-item" data-event="free">
                <span class="legend-swatch free"></span>
                Free
              </div>
              <div class="legend-item" data-event="realloc">
                <span class="legend-swatch realloc"></span>
                Realloc
              </div>
              <div class="legend-item" data-event="transfer_h2d">
                <span class="legend-swatch transfer_h2d"></span>
                H2D
              </div>
              <div class="legend-item" data-event="transfer_d2h">
                <span class="legend-swatch transfer_d2h"></span>
                D2H
              </div>
              <div class="legend-item" data-event="transfer_d2d">
                <span class="legend-swatch transfer_d2d"></span>
                D2D
              </div>
            </div>
          </div>
        </div>
        <div id="allocs"></div>
      </section>
      <aside class="inspector">
        <div class="inspector-card">
          <div class="inspector-title">Top Nodes</div>
          <div class="inspector-controls">
            <label class="control">
              <span>List Metric</span>
              <select id="listSelect"></select>
            </label>
            <label class="control">
              <span>Count</span>
              <input id="listCount" type="number" min="5" max="200" value="30" />
            </label>
          </div>
          <div id="topList" class="top-list"></div>
        </div>
        <div class="inspector-card">
          <div class="inspector-title">Details</div>
          <div id="detailBody" class="detail-body">Hover a tile to inspect metrics.</div>
        </div>
        <div class="inspector-card" id="systemCard" hidden>
          <div class="inspector-title">System</div>
          <div id="systemInfo" class="system-info"></div>
        </div>
      </aside>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="app.js"></script>
  </body>
</html>
